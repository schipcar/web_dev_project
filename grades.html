<!DOCTYPE html>
<html>

<head>
  <link rel=stylesheet href="canvas_styles.css" TYPE="text/css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assignments</title>
</head>


<body>

  <div id="header">
    <h2 id="Grades_title">Grades</h2>
  </div>


<div id="demo">
<button type="button" onclick="Grades()">Load Grades</button>
</div>
<div id="dinamic">
</div>

<form name="myform" action="http://localhost:8080/putdictionary" method="post">
  <fieldset>
    <label for="email">Email:</label>
    <input type="text" id="email" name="email" placeholder="email" />
    <label for="punctuation">Punctuation:</label>
    <input type="number" id="punctuation" name="punctuation" placeholder="punctuation" />
    <label for="possible">Possible:</label>
    <input type="number" id="possible" name="possible" placeholder="possible" />
    <label for="course_name">Course:</label>
    <input type="text" id="course_name" name="course_name" placeholder="course_name" />    
    <input type="submit" value="Send message" />

</fieldset>
</form>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
var counter = 0;
var Preferences = 0;
var nrows = 0;
Preferences.id = "tbl";
var Mode_User = "Student"
var Student = "claudio@hotmail.com"

function Grades(){
  if (Mode_User = "Student") {
    LoadGrades_p1()
    LoadGrades_p2()
  } else { LoadAllGrades() }};

function LoadGrades_p1() {
  $.ajax({
        type: "POST",
        url: "http://localhost:8080/gradestudent",
        crossDomain: true,
        data: {student:Student},
        success: function (data) {
            // SOMETHING
        },
        error: function (err) {
            // SOMETHING
        }
    });
  };


function LoadGrades_p2() {
  var xhttp = new XMLHttpRequest();
  xhttp.overrideMimeType("application/json");
  xhttp.open("GET", "http://localhost:8080/gradestudent2", true);
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
           var dict_all = JSON.parse(this.responseText);
           var list_array = new Array();
           for (var i=0; i<dict_all.length; i++) {
             const dict_t = dict_all[i];
             const array1 = [dict_t.email, dict_t.punctuation, dict_t.possible, dict_t.course_name];
             list_array.push(array1)}
             nrows = dict_all.length
          createtable("tbl", list_array, nrows);}
   }
   xhttp.send();
}

function LoadAllGrades() {
  var xhttp = new XMLHttpRequest();
  xhttp.overrideMimeType("application/json");
  xhttp.open("GET", "http://localhost:8080/getdictionary", true);
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
           var dict_all = JSON.parse(this.responseText);
           var list_array = new Array();
           for (var i=0; i<dict_all.length; i++) {
             const dict_t = dict_all[i];
             const array1 = [dict_t.email, dict_t.punctuation, dict_t.possible, dict_t.course_name];
             list_array.push(array1)}
             nrows = dict_all.length
          createtable("tbl", list_array, nrows);}
   }
   xhttp.send();
}

createtable = function(id, list_array, nrows){
    var TableDiv = document.getElementById("dinamic");  
    var ncells = 4;
    var names = ["Email", "Punctuation", "Possible", "Course"];
    
    var table = document.createElement('TABLE');
    table.border='1';
    var tableBody = document.createElement('TBODY');
    table.appendChild(tableBody);
    table.id = id
    var header = table.createTHead();
    var row = header.insertRow(0);
    
    for (var p=0; p<4; p++){
           var cell = row.insertCell(p);
           cell.innerHTML = names[p];
    }

    for (var i=0; i<nrows; i++){
       var tr = document.createElement('TR');
       tableBody.appendChild(tr);
       
       for (var j=0; j<ncells; j++){
           var td = document.createElement('TD');
           console.log(list_array[i])
           td.appendChild(document.createTextNode(String(list_array[i][j])));
           tr.appendChild(td);
       }
    }
    if (Preferences == 0) {
      Preferences = table;
      TableDiv.appendChild(table) 
    } else {
      TableDiv.removeChild(TableDiv.lastChild)
      Preferences = table;
    }
    
    TableDiv.appendChild(table)   
}


</script>
</body>
</html>